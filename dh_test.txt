================================================================================
                    전체 에이전트 시스템 데이터 흐름
================================================================================

1. 의도한 구조 (Collector 패턴)
--------------------------------------------------------------------------------

┌──────────┐    ┌──────────┐    ┌───────────────┐    ┌──────────┐    ┌──────────┐
│  DB/API  │ -> │  Loader  │ -> │   Collector   │ -> │  Agent   │ -> │   결과   │
│  (원천)  │    │  (조회)  │    │  (수집/통합)  │    │  (계산)  │    │  (출력)  │
└──────────┘    └──────────┘    └───────────────┘    └──────────┘    └──────────┘

* Collector가 여러 Loader를 통합 관리
* Agent는 collected_data만 받아서 순수 계산


2. 현재 상태 (불일치)
--------------------------------------------------------------------------------

[Hazard Score Agent] - 의도한 패턴 ✅
    DB → Loader → HazardDataCollector → Agent

[Probability Agent] - 직접 호출로 변경됨 ❌
    DB → Loader → Agent (내부에서 직접 Loader 호출)

[Exposure Agent] - 의도한 패턴 ✅
    DB → Loader → HazardDataCollector → collected_data → Agent

[Vulnerability Agent] - Agent → DatabaseConnection 직접 호출 ❌
    (초기 커밋: collected_data를 외부에서 받음 ✅)
    (2b7c60b 커밋에서 fetch_building_data_from_db() 추가로 DB 직접 호출)

* 참고: site_risk_calculator.py에서의 의도한 흐름:
    HazardDataCollector.collect_all_data() → collected_data
        → ExposureAgent.calculate_exposure(collected_data)
        → VulnerabilityAgent.calculate_vulnerability(collected_data + exposure)


3. 계층별 역할 (의도한 구조)
--------------------------------------------------------------------------------

[1] 원천 데이터 (DB/API)
    - PostgreSQL: kma_ssp_sgg261, sea_level_grid, api_typhoon_*, api_wamis_*

[2] DataLoader (조회 담당)
    - ClimateDataLoader: 기후 데이터 조회
    - SpatialDataLoader: 공간 데이터 조회
    - BuildingDataFetcher: 건물 데이터 조회
    - 위치: modelops/data_loaders/

[3] Collector (수집/통합 담당)
    - HazardDataCollector: 모든 Loader 통합 → collected_data 생성
    - 위치: modelops/utils/hazard_data_collector.py

[4] Agent (순수 계산 담당)
    - calculate_probability(collected_data) → 결과 반환
    - Agent는 DB/Loader 직접 접근 X
    - 위치: modelops/agents/


4. TODO: Probability Agent 수정 필요
--------------------------------------------------------------------------------

현재 Probability Agent에 추가된 메서드:
- calculate(lat, lon, ssp_scenario)  ← Agent가 직접 Loader 호출
- _build_collected_data()            ← Agent 내부에서 변환

→ Collector 패턴으로 통일 필요

================================================================================
