"""
Base Vulnerability Agent with common utilities for all vulnerability calculations.
"""
from typing import Dict, Any
import logging

try:
    from modelops.config import hazard_config as config
except ImportError:
    config = None

logger = logging.getLogger(__name__)


class BaseVulnerabilityAgent:
    """
    Base class for all vulnerability calculation agents.

    Provides common utility methods that are shared across different hazard types.
    """

    def __init__(self):
        pass

    def calculate_vulnerability(self, exposure: Dict[str, Any]) -> Dict[str, Any]:
        """
        Calculate vulnerability for a specific hazard type.
        Must be implemented by child classes.

        Args:
            exposure: Exposure data dictionary

        Returns:
            Vulnerability data dictionary with score, level, and factors
        """
        raise NotImplementedError("Subclasses must implement calculate_vulnerability()")

    def _get_age_penalty(self, age: int, penalties: Dict[str, int]) -> int:
        """
        Calculate penalty score based on building age.

        Args:
            age: Building age in years
            penalties: Dictionary of age penalties (high, medium)

        Returns:
            Penalty score
        """
        if not config:
            return 0
        age_thresholds = config.VULNERABILITY_AGE_THRESHOLDS
        if age > age_thresholds['high']:
            return penalties.get('high', 0)
        elif age > age_thresholds['medium']:
            return penalties.get('medium', 0)
        return 0

    def _score_to_level(self, score: float) -> str:
        """
        Convert vulnerability score to level.

        Args:
            score: Vulnerability score (0-100)

        Returns:
            Vulnerability level (very_high/high/medium/low/very_low)
        """
        if score >= 80:
            return 'very_high'
        elif score >= 60:
            return 'high'
        elif score >= 40:
            return 'medium'
        elif score >= 20:
            return 'low'
        else:
            return 'very_low'

    def _get_default_vulnerability(self) -> Dict[str, Any]:
        """
        Get default vulnerability values.

        Returns:
            Default vulnerability dictionary
        """
        return {
            'score': 50,
            'level': 'medium',
            'factors': {'note': 'Default value due to missing data'}
        }
